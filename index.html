<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Registro QR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b1220" />

  <link rel="manifest" href="./manifest.json" />
  <link rel="stylesheet" href="./style.css" />

  <!-- html5-qrcode (LOCAL, para offline) -->
  <script src="./html5-qrcode.min.js" defer></script>

  <!-- APP -->
  <script src="./app.20260212-07.js" defer></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">QR</div>
      <div>
        <div class="title">Registro por QR (offline)</div>
        <div class="subtitle">Inasistencia ‚Ä¢ Llegadas tarde ‚Ä¢ Convivencia</div>
      </div>
    </div>
    <div class="badge">Versi√≥n: 2026-02-12-07</div>
  </header>

  <main class="container">

    <section class="card">
      <div class="card-title">1) Escanear</div>
      <div class="row">
        <button id="scanBtn" class="btn primary" type="button">üì∑ Escanear QR</button>
        <button id="cancelScanBtn" class="btn ghost" type="button" style="display:none;">‚úñ Cancelar</button>
      </div>

      <div id="qr-reader" class="qr-reader" style="display:none;"></div>

      <div class="notice" id="notice">
        <strong>Listo.</strong> Presiona <em>Escanear QR</em>.
      </div>
    </section>

    <section class="card">
      <div class="card-title">2) Clasificar evento</div>

      <div class="kv">
        <div id="codigoActual" class="kv-item">C√≥digo: ‚Äî</div>
        <div id="horaActual" class="kv-item">Hora: ‚Äî</div>
      </div>

      <div id="formEvento" class="form" style="display:none;">
        <div class="field">
          <label for="tipo">Tipo</label>
          <select id="tipo">
            <option value="INASISTENCIA">Inasistencia</option>
            <option value="TARDE">Llegada tarde</option>
            <option value="CONVIVENCIA">Convivencia (falta)</option>
          </select>
        </div>

        <div class="field" id="wrapExcusa" style="display:none;">
          <label for="excusa">Excusa</label>
          <select id="excusa">
            <option value="SIN_EXCUSA">Sin excusa</option>
            <option value="CON_EXCUSA">Con excusa</option>
          </select>
        </div>

        <div class="field" id="wrapNivel" style="display:none;">
          <label for="nivel">Clasificaci√≥n (Tipo I / II / III)</label>
          <select id="nivel">
            <option value="TIPO_I">Tipo I</option>
            <option value="TIPO_II">Tipo II</option>
            <option value="TIPO_III">Tipo III</option>
          </select>
        </div>

        <div class="field" id="wrapFalta" style="display:none;">
          <label for="falta">Falta espec√≠fica (seg√∫n Manual)</label>
          <select id="falta">
            <option value="">‚Äî seleccionar ‚Äî</option>
            <option value="_OTRA">Otra (guardar nueva)</option>
          </select>
          <div class="small">Tip: puedes guardar una falta nueva y quedar√° disponible para ese tipo.</div>
        </div>

        <div class="field" id="wrapFaltaOtra" style="display:none;">
          <label for="faltaOtra">Escribe la falta (se guardar√° en la lista)</label>
          <input id="faltaOtra" type="text" placeholder="Ej: I.16 ‚Äî ..." />
        </div>

        <div class="field" id="wrapObsTipo" style="display:none;">
          <label for="obsTipo">Observaci√≥n tipo (para llegadas tarde)</label>
          <select id="obsTipo">
            <option value="">‚Äî seleccionar ‚Äî</option>
            <option value="_OTRA">Otra (escribir abajo)</option>
          </select>
          <div class="small">Tip: si eliges una opci√≥n, se copiar√° a ‚ÄúObservaci√≥n‚Äù.</div>
        </div>

        <div class="field">
          <label for="obs">Observaci√≥n (opcional)</label>
          <textarea id="obs" placeholder="Ej: lleg√≥ 10 min tarde por transporte / llamado de atenci√≥n por ruido..."></textarea>
        </div>

        <div class="row">
          <button id="guardarBtn" class="btn ok" type="button">üíæ Guardar</button>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="card-title">3) Historial</div>
      <div class="row between">
        <div class="muted">Total: <span id="totalReg">0</span></div>
        <div class="muted">Se guarda localmente (offline)</div>
      </div>

      <div class="row" style="margin-top:10px;">
        <button id="syncBtn" class="btn primary" type="button">‚òÅÔ∏è Sincronizar a Google Sheets</button>
        <button id="exportarBtn" class="btn" type="button">‚¨á Exportar CSV</button>
        <button id="limpiarBtn" class="btn warn" type="button">üßπ Limpiar todo</button>
      </div>

      <div id="historial" class="historial" style="margin-top:12px;"></div>
    </section>

  </main>

  <footer class="footer">
    <span class="muted">Funciona offline ‚Ä¢ Datos guardados en este dispositivo</span>
  </footer>

  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./service-worker.js", { updateViaCache: "none" });
      });
    }
  </script>
</body>
</html>
